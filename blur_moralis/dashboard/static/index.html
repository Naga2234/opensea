<!doctype html><html><head>
<meta charset="utf-8"/>
<link rel="icon" href="/static/favicon.svg">
<title>PRO‑SAFE v2.7 (Moralis — Modes & UX)</title>
<link rel="stylesheet" href="/static/style.css"/>
</head><body>
<header class="page-header">
  <div>
    <h1>PRO‑SAFE v2.7</h1>
    <p class="subtitle">Moralis Full (Polygon)</p>
  </div>
  <div class="header-meta">
    <span class="meta-pill">Dashboard</span>
    <span class="meta-pill">UX refresh</span>
  </div>
</header>

<div class="grid">
  <div class="card">
    <div class="pill-grid">
      <div class="pill">Адрес: <b id="addr">—</b></div>
      <div class="pill">Сеть: <b id="chain">—</b></div>
      <div class="pill">EXEC: <b id="mode">—</b></div>
      <div class="pill">Риск: <b id="riskCur">—</b></div>
      <div class="pill">LIVE: <b id="live">—</b></div>
      <div class="pill">Баланс: <b id="bal">—</b> <span id="balSymbol" class="badge" style="display:none"></span> <span id="balSrcBadge" class="badge"></span></div>
      <div class="pill">Коллекция: <b id="collectionCount">—</b></div>
    </div>
  </div>

  <div class="card">
    <div class="label">Быстрые действия</div>
    <div class="row">
      <button class="btn" id="rpc">Проверить RPC</button>
      <button class="btn" id="test">Тест</button>
      <select id="modeSel" class="input-control"><option value="paper">paper</option><option value="live">live</option><option value="auto">auto</option></select>
      <button class="btn" id="modeSave">Сохранить режим</button>
      <button class="btn accent" id="start">Старт</button>
      <button class="btn ghost" id="stop">Стоп</button>
    </div>
    <div class="engine-status" id="engineStatus" data-state="unknown" aria-live="polite">
      <div class="engine-status__header">
        <span class="engine-status__dot" aria-hidden="true"></span>
        <span class="engine-status__label">Статус:</span>
        <span class="engine-status__value" id="engineStatusText">—</span>
      </div>
      <div class="engine-status__bar" role="presentation">
        <div class="engine-status__progress" id="engineStatusProgress"></div>
      </div>
      <div class="engine-status__meta muted" id="engineStatusMeta">Нет данных</div>
    </div>
    <div class="engine-trade" id="tradeStatus" aria-live="polite">
      <div class="engine-trade__header">
        <span class="engine-trade__label">Сделка</span>
        <span class="engine-trade__badge" id="tradeStatusBadge">—</span>
      </div>
      <div class="engine-trade__bar">
        <div class="engine-trade__progress" id="tradeStatusProgress"></div>
      </div>
      <div class="engine-trade__meta muted" id="tradeStatusMeta">Ожидаем сигнал</div>
    </div>
  </div>

  <div class="card">
    <h3>Стратегии</h3>
    <div class="row">
      <select id="strategySel" class="input-control">
        <option value="auto" selected>Авто (переключение)</option>
        <option value="undercut">undercut</option>
        <option value="mean_revert">mean_revert</option>
        <option value="momentum">momentum</option>
        <option value="hybrid">hybrid</option>
      </select>
      <button class="btn" id="strategySave">Применить</button>
    </div>
    <div class="muted" id="strategyHint">Авто: движок сам выбирает подходящую стратегию.</div>
  </div>

  <div class="card">
    <h3>Профили риска</h3>
    <div class="row">
      <select id="riskSel" class="input-control">
        <option value="conservative">Консервативный</option>
        <option value="balanced" selected>Сбалансированный</option>
        <option value="aggressive">Агрессивный</option>
      </select>
      <button class="btn" id="riskSave">Применить</button>
    </div>
    <div id="riskDesc" class="muted" style="margin-top:6px">Сбалансировано: стандартные лимиты, средний размер позиции.</div>
    <div class="mini-pill" style="margin-top:12px">Текущий лидер по прибыли: <b id="riskStatsHighlight">—</b></div>
  </div>

  <div class="card">
    <h3>Статистика профилей риска</h3>
    <div class="muted" style="margin-bottom:12px">Данные обновляются в реальном времени каждые 4 секунды.</div>
    <div class="risk-table-wrap">
      <table class="risk-table">
        <thead>
          <tr>
            <th>Профиль</th>
            <th>Сделок</th>
            <th>Win‑rate</th>
            <th>Avg PnL</th>
            <th>Общая прибыль</th>
          </tr>
        </thead>
        <tbody id="riskStatsBody"></tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <h3>OpenSea (для LIVE)</h3>
    <div class="row"><input id="osKey" class="input-control" style="flex:1" placeholder="X-API-KEY"/><button class="btn" id="osSave">Сохранить ключ</button></div>
  </div>

  <div class="card">
    <h3>Сеть и пресеты</h3>
    <div class="row">
      <select id="chainSel" class="input-control"><option value="eth">Ethereum</option><option value="polygon" selected>Polygon</option></select>
      <button class="btn" id="chainSave">Сохранить сеть</button>
      <button class="btn" id="presetPoly" onclick="fetch('/api/preset_lowcap_polygon',{method:'POST'}).then(r=>r.json()).then(ap)">Low‑Cap (Polygon)</button>
    </div>
  </div>

  <div class="card">
    <h3>Источник баланса</h3>
    <div class="row">
      <select id="balSrc" class="input-control">
        <option value="auto" selected>auto</option>
        <option value="rpc">rpc</option>
        <option value="moralis">moralis</option>
      </select>
      <button class="btn" id="balSrcSave">Сохранить</button>
      <span class="muted">auto: сначала RPC, если пусто — Moralis (экономит CU)</span>
    </div>
  </div>

  <div class="card">
    <h3>Moralis CU Usage</h3>
    <div class="usage-meter">
      <div class="usage-meter__labels">
        <span id="cuUsageLabel">—</span>
        <span id="cuUsageRemaining" class="usage-meter__remaining">—</span>
      </div>
      <div class="usage-meter__bar">
        <div class="usage-meter__progress" id="cuUsageProgress"></div>
      </div>
      <div class="muted usage-meter__meta" id="cuUsageMeta">Нет данных</div>
    </div>
  </div>

  <div class="card">
    <h3>Контракты</h3>
    <textarea id="contracts" class="input-control area"></textarea>
    <div class="row"><button class="btn" id="applyContracts">Применить</button></div>
  </div>

  <div class="card" style="grid-column:1 / -1">
    <h3>KPI / Risk</h3>
    <div id="nl" class="pill">Статистика появится после первых сделок.</div>
    <div class="row">
      <div style="flex:1">undercut <span id="wr_u">0%</span><div class="bar"><i id="bar_u"></i></div></div>
      <div style="flex:1">mean_revert <span id="wr_mr">0%</span><div class="bar"><i id="bar_mr"></i></div></div>
      <div style="flex:1">momentum <span id="wr_m">0%</span><div class="bar"><i id="bar_m"></i></div></div>
      <div style="flex:1">hybrid <span id="wr_h">0%</span><div class="bar"><i id="bar_h"></i></div></div>
    </div>
    <div class="muted" style="margin-top:6px">Лучший режим/стратегия: <b id="best">—</b></div>
  </div>

  <div class="card" style="grid-column:1 / -1">
    <h3>Лог</h3>
    <div class="log-split">
      <div class="log-column">
        <h4>Важные события</h4>
        <div id="logImportant" class="log-panel" aria-live="polite" data-empty="true"></div>
      </div>
      <div class="log-column">
        <h4>Остальные события</h4>
        <div id="logOther" class="log-panel" aria-live="polite" data-empty="true"></div>
      </div>
    </div>
  </div>
</div>

<script src="/static/app.js"></script>
</body></html>
